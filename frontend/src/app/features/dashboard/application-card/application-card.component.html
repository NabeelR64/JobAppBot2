<div class="app-card" [class.needs-input-card]="needsUserInput">
  <div class="card-header">
    <div class="company-avatar" [style.background-color]="avatarColor">
      {{ companyInitial }}
    </div>
    <div class="card-info">
      <h4 class="job-title">{{ application.job_posting.title }}</h4>
      <p class="company-name">{{ application.job_posting.company_name }}</p>
    </div>
    <a *ngIf="application.job_posting.url" [href]="application.job_posting.url" target="_blank" class="external-link"
      title="View job posting">
      ‚Üó
    </a>
  </div>

  <div class="card-meta">
    <span class="date">{{ application.created_at | date:'MMM d, y' }}</span>
    <span class="status-badge" [ngClass]="statusClass">{{ statusLabel }}</span>
  </div>

  <div class="manual-warning" *ngIf="application.status === 'MANUAL_INTERVENTION_REQUIRED'">
    <span class="warning-icon">‚ö†Ô∏è</span>
    <span>Needs manual application</span>
    <a *ngIf="application.job_posting.url" [href]="application.job_posting.url" target="_blank" class="apply-link">Apply
      ‚Üí</a>
  </div>

  <!-- User Input Form: shown when bot needs help filling fields -->
  <div class="user-input-section" *ngIf="needsUserInput && missingFields.length > 0">
    <div class="input-header">
      <span class="input-icon">‚úçÔ∏è</span>
      <span class="input-title">Bot filled {{ filledFieldCount }} fields ‚Äî need your help with {{ missingFields.length
        }} more:</span>
    </div>

    <div class="input-fields">
      <div class="input-field" *ngFor="let field of missingFields">
        <label [for]="'field-' + application.id + '-' + field.key">{{ field.label }}</label>
        <textarea *ngIf="field.type === 'textarea'" [id]="'field-' + application.id + '-' + field.key"
          [(ngModel)]="userInputValues[field.key]" [placeholder]="'Enter ' + field.label" rows="2"></textarea>
        <input *ngIf="field.type !== 'textarea' && field.type !== 'file'"
          [id]="'field-' + application.id + '-' + field.key" [type]="field.type || 'text'"
          [(ngModel)]="userInputValues[field.key]" [placeholder]="'Enter ' + field.label" />
        <span *ngIf="field.type === 'file'" class="file-note">
          Resume will be uploaded automatically
        </span>
      </div>
    </div>

    <button class="resume-btn" (click)="onProvideFields()" [disabled]="submittingFields">
      <span *ngIf="!submittingFields">üöÄ Resume Application</span>
      <span *ngIf="submittingFields">‚è≥ Resuming...</span>
    </button>
  </div>

  <div class="card-actions">
    <select class="status-select" [value]="application.status" (change)="onStatusChange($event)">
      <option value="PENDING_AUTOMATION">Pending</option>
      <option value="USER_INPUT_NEEDED">Needs Input</option>
      <option value="APPLIED">Applied</option>
      <option value="EMAIL_CONFIRMATION_RECEIVED">Confirmed</option>
      <option value="INTERVIEW_INVITED">Interview</option>
      <option value="FOLLOW_UP_RECEIVED">Follow-Up</option>
      <option value="OTHER_UPDATE">Other</option>
      <option value="REJECTED">Rejected</option>
      <option value="FAILED">Failed</option>
      <option value="MANUAL_INTERVENTION_REQUIRED">Needs Action</option>
    </select>
  </div>
</div>